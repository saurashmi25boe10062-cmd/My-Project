# services/ml_service.py - Handles all machine learning operations

class MLModelService:
    def __init__(self, model_path):
        """Loads the pre-trained model into memory."""
        # Use simple file handling for loading the model object
        try:
            with open(model_path, 'rb') as file:
                self.model = pickle.load(file)
            print(f"INFO: Model loaded successfully from {model_path}")
        except FileNotFoundError:
            self.model = None
            raise Exception(f"ML Model file not found at {model_path}. Run training script first!")

    def predict_risk(self, feature_vector):
        """Calculates the probability of chronic disease."""
        if not self.model:
            raise Exception("Model is not initialized.")
        
        # Convert the feature vector (array/list) into a DataFrame
        features_df = pd.DataFrame([feature_vector], columns=Config.MODEL_FEATURES)
        
        # Predict probability of the positive class (1=High Risk)
        prediction_proba = self.model.predict_proba(features_df)
        risk_score = round(prediction_proba[0][1], 3)
        
        return risk_score